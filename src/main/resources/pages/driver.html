<!DOCTYPE html>
<html>
<head>
    <title>Location Tracking</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</head>
<body>
<div id="locationUpdates"></div>
<h2> Welcome [[${driver.drivername}]]...You have a ride with booking Id :[[${driver.bookId}]] </h2>

<script>
    var previousLocation = null;
    //changes by manju--commented
     //var tripId = getQueryParam('tripId'); // Retrieve the tripId from URL parameter
    // var status = getQueryParam('status');
    // var driver = getQueryParam('driver');
    // function getQueryParam(param) {
    //     var urlParams = new URLSearchParams(window.location.search);
    //     return urlParams.get(param);
    // }

    var tripId=[[${driver.bookId}]];
    var status="[[${driver.rideStatus}]]";
    var driver="[[${driver.drivername}]]";
    var pickLat=[[${driver.pickLat}]];
    var pickLong=[[${driver.pickLong}]];
    var dropLat=[[${driver.dropLat}]];
    var dropLong=[[${driver.dropLong}]];



    // Function to send AJAX request and save location data
    function saveLocation(latitude, longitude, tripId) {
        var locationData = {
            latitude: latitude,
            longitude: longitude,
            tripId: tripId
        };

        // Check if the location has changed
        if (
            !previousLocation ||
            previousLocation.latitude !== locationData.latitude ||
            previousLocation.longitude !== locationData.longitude ||
            previousLocation.tripId !== locationData.tripId
        ) {
            // AJAX request to the backend API
            $.ajax({
                url: '/save-location', // Replace with your actual backend API endpoint
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(locationData),
                success: function(response) {
                    console.log('Location data saved successfully!');
                    previousLocation = locationData; // Update previous location
                },
                error: function(error) {
                    console.error('Error saving location data:', error);
                }
            });
        }
    }


    // Function to track location changes
    function trackLocation() {


        if (navigator.geolocation) {
            navigator.geolocation.watchPosition(
                function(position) {
                    var latitude = position.coords.latitude;
                    var longitude = position.coords.longitude;
                    $('#locationUpdates').append('<p>Latitude: ' + latitude + ', Longitude: ' + longitude + ', TripId: ' + tripId+ '</p>');

                    // Call the function to save the location data
                    saveLocation(latitude, longitude, tripId);

                },
                function(error) {
                    console.error('Error getting location:', error);
                }
            );
        } else {
            console.error('Geolocation is not supported by this browser.');
        }
    }


    // Start tracking location when the page loads
    $(document).ready(function() {
        trackLocation();

    });

</script>



</body>
</html>
